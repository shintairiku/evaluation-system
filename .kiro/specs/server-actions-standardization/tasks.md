# 実装計画: Server Actions Standardization and Implementation

> このドキュメントは、設計書に基づいて実際に行う開発タスクを洗い出し、管理するためのものです。タスクは階層的に分割し、関連する要件を明記することで、進捗とトレーサビリティを確保します。

## 機能A: エンドポイントファイルの標準化と実装

### 1. 欠落しているエンドポイントファイルの実装
> バックエンドAPIに対応するフロントエンドエンドポイントファイルを作成し、1:1マッピングを確立します。

- [x] **1.1. departments.ts エンドポイントファイルの作成** ✅
  > DepartmentのCRUD操作に対応するAPI関数を実装。型定義も含める。
  >
  > **関連要件:** 2.1, 2.2

- [x] **1.2. roles.ts エンドポイントファイルの作成** ✅
  > RoleのCRUD操作とreorder機能に対応するAPI関数を実装。
  >
  > **関連要件:** 2.1, 2.2

- [x] **1.3. stages.ts エンドポイントファイルの作成** ✅
  > StageのCRUD操作とadmin機能に対応するAPI関数を実装。
  >
  > **関連要件:** 2.1, 2.2

- [x] **1.4. evaluation-periods.ts エンドポイントファイルの作成** ✅
  > EvaluationPeriodのCRUD操作に対応するAPI関数を実装。
  >
  > **関連要件:** 2.1, 2.2

- [x] **1.5. competencies.ts エンドポイントファイルの作成** ✅
  > CompetencyのCRUD操作に対応するAPI関数を実装。
  >
  > **関連要件:** 2.1, 2.2

- [x] **1.6. self-assessments.ts エンドポイントファイルの作成** ✅
  > SelfAssessmentのCRUD操作と関連機能のAPI関数を実装。
  >
  > **関連要件:** 2.1, 2.2

- [x] **1.7. supervisor-reviews.ts エンドポイントファイルの作成** ✅
  > SupervisorReviewのCRUD操作と関連機能のAPI関数を実装。
  >
  > **関連要件:** 2.1, 2.2

- [x] **1.8. supervisor-feedbacks.ts エンドポイントファイルの作成** ✅
  > SupervisorFeedbackのCRUD操作と関連機能のAPI関数を実装。
  >
  > **関連要件:** 2.1, 2.2

### 2. 型定義ファイルの実装
> 各リソースに対応するTypeScript型定義を作成します。

- [x] **2.1. department.ts 型定義ファイルの作成** ✅
  > Department関連の型（Department, DepartmentCreate, DepartmentUpdate, DepartmentDetail）を定義。
  >
  > **関連要件:** 2.2, 5.1

- [x] **2.2. role.ts 型定義ファイルの作成** ✅
  > Role関連の型とreorder用の型を定義。
  >
  > **関連要件:** 2.2, 5.1

- [x] **2.3. stage.ts 型定義ファイルの作成** ✅
  > Stage関連の型とユーザーカウント付きの型を定義。
  >
  > **関連要件:** 2.2, 5.1

- [x] **2.4. evaluation-period.ts 型定義ファイルの作成** ✅
  > EvaluationPeriod関連の型を定義。
  >
  > **関連要件:** 2.2, 5.1

- [x] **2.5. self-assessment.ts 型定義ファイルの作成** ✅
  > SelfAssessment関連の型を定義。
  >
  > **関連要件:** 2.2, 5.1

- [x] **2.6. supervisor-review.ts 型定義ファイルの作成** ✅
  > SupervisorReview関連の型を定義。
  >
  > **関連要件:** 2.2, 5.1

- [x] **2.7. supervisor-feedback.ts 型定義ファイルの作成** ✅
  > SupervisorFeedback関連の型を定義。
  >
  > **関連要件:** 2.2, 5.1

## 機能B: サーバーアクションの標準化と実装

### 3. 既存サーバーアクションの標準化
> 現在のgoals.tsサーバーアクションを標準パターン（endpoints経由）に修正します。

- [x] **3.1. goals.ts サーバーアクションの修正** ✅
  > 直接HTTPクライアント使用からendpoints経由のパターンに変更。
  >
  > **関連要件:** 1.1, 1.2

- [x] **3.2. goals.ts エンドポイントファイルの作成** ✅
  > Goals用のエンドポイントファイルを作成し、サーバーアクションから使用。
  >
  > **関連要件:** 1.1, 2.1

### 4. 新規サーバーアクションの実装
> すべてのエンドポイントに対応するサーバーアクションを実装します。

- [x] **4.1. departments.ts サーバーアクションの作成** ✅
  > Department用の標準化されたサーバーアクションを実装。
  >
  > **関連要件:** 3.1, 3.2

- [x] **4.2. roles.ts サーバーアクションの作成** ✅
  > Role用の標準化されたサーバーアクションを実装。
  >
  > **関連要件:** 3.1, 3.2

- [x] **4.3. stages.ts サーバーアクションの作成** ✅
  > Stage用の標準化されたサーバーアクションを実装。
  >
  > **関連要件:** 3.1, 3.2

- [x] **4.4. evaluation-periods.ts サーバーアクションの作成** ✅
  > EvaluationPeriod用の標準化されたサーバーアクションを実装。
  >
  > **関連要件:** 3.1, 3.2

- [x] **4.5. self-assessments.ts サーバーアクションの作成** ✅
  > SelfAssessment用の標準化されたサーバーアクションを実装。
  >
  > **関連要件:** 3.1, 3.2

- [x] **4.6. supervisor-reviews.ts サーバーアクションの作成** ✅
  > SupervisorReview用の標準化されたサーバーアクションを実装。
  >
  > **関連要件:** 3.1, 3.2

- [x] **4.7. supervisor-feedbacks.ts サーバーアクションの作成** ✅
  > SupervisorFeedback用の標準化されたサーバーアクションを実装。
  >
  > **関連要件:** 3.1, 3.2

## 機能C: Next.js キャッシュメカニズムの実装

### 5. Request Memoization の適用
> 読み取り専用サーバーアクションにRequest Memoizationを適用します。

- [ ] **5.1. cache() wrapper 関数の作成**
  > React cacheを使用したWrapper関数を作成。
  >
  > **関連要件:** 4.1

- [ ] **5.2. 読み取り専用アクションへのキャッシュ適用**
  > すべてのget系サーバーアクションにRequest Memoizationを適用。
  >
  > **関連要件:** 4.1, 4.2

### 6. Data Cache の実装
> 長時間キャッシュが有効なデータにData Cacheを適用します。

- [ ] **6.1. 静的データのキャッシュ戦略実装**
  > departments, roles, stagesなど比較的静的なデータにData Cacheを適用。
  >
  > **関連要件:** 4.2, 4.3

- [ ] **6.2. 動的データのキャッシュ戦略実装**
  > goals, assessmentsなど頻繁に更新されるデータの適切なキャッシュ戦略を実装。
  >
  > **関連要件:** 4.2, 4.3

- [ ] **6.3. キャッシュタグシステムの実装**
  > データの種類に応じたキャッシュタグを定義し、適切な再検証を実装。
  >
  > **関連要件:** 4.3

### 7. キャッシュ再検証の実装
> データ変更時の適切なキャッシュ再検証を実装します。

- [ ] **7.1. Create/Update/Delete アクションでの再検証**
  > すべてのミューテーションアクションに適切なrevalidateTagを実装。
  >
  > **関連要件:** 4.3

- [ ] **7.2. 関連データの連鎖再検証**
  > データ間の関係に基づいた連鎖的なキャッシュ再検証を実装。
  >
  > **関連要件:** 4.3

## 機能D: インデックスファイルとエクスポートの更新

### 8. インデックスファイルの更新
> 新しいファイルをインデックスファイルに追加し、適切にエクスポートします。

- [ ] **8.1. endpoints/index.ts の更新**
  > 新規作成したすべてのエンドポイントファイルをエクスポート。
  >
  > **関連要件:** 5.1

- [ ] **8.2. server-actions/index.ts の更新**
  > 新規作成したすべてのサーバーアクションファイルをエクスポート。
  >
  > **関連要件:** 5.1

- [ ] **8.3. types/index.ts の更新**
  > 新規作成したすべての型定義ファイルをエクスポート。
  >
  > **関連要件:** 5.1

- [ ] **8.4. API constants の更新**
  > 必要に応じてAPI_ENDPOINTSの追加定義を確認・更新。
  >
  > **関連要件:** 2.1

## 全般タスク

### 9. 品質保証とテスト

- [ ] **9.1. TypeScript コンパイルエラーの解消**
  > すべての型定義とインポートが正しく動作することを確認。
  >
  > **関連要件:** 5.1

- [ ] **9.2. Lint エラーの解消**
  > ESLint, Prettier などのコーディング規約に準拠。
  >
  > **関連要件:** 5.1

- [ ] **9.3. JSDoc コメントの追加**
  > すべての公開関数に適切なドキュメンテーションを追加。
  >
  > **関連要件:** 5.1

### 10. 動作確認とテスト

- [ ] **10.1. サーバーアクションの動作確認**
  > 各サーバーアクションが正しく動作することを確認。
  >
  > **関連要件:** 1.1, 3.1

- [ ] **10.2. キャッシュ機能の動作確認**
  > Request Memoization と Data Cache が正しく動作することを確認。
  >
  > **関連要件:** 4.1, 4.2

- [ ] **10.3. エラーハンドリングの確認**
  > 各種エラーケースで適切なエラーレスポンスが返されることを確認。
  >
  > **関連要件:** 1.2, 3.2