# 実装計画: Frontend User Server Action Standardization

> このドキュメントは、users server actionをgoals server actionと統一するための実装タスクを管理します。一貫性のあるAPIレイヤーアーキテクチャを構築し、コードの保守性を向上させます。

## 機能A: Server Actionの実装パターン統一

### 1. 新しいusers server actionの実装
> goals server actionと同じパターンで、users server actionを完全に書き直します。endpoints/users.tsへの依存を排除し、直接HTTP clientを使用するように変更します。

- [ ] **1.1. 既存のusers server actionファイルのバックアップ作成**
  > 現在の `frontend/src/api/server-actions/users.ts` をリファクタリング前にバックアップします。予期せぬ問題が発生した場合の復旧用として保存します。
  >
  > **関連要件:** 要件5 (コードの削減と重複排除)

- [ ] **1.2. 新しいusers server actionの実装（基本CRUD操作）**
  > goals.tsのパターンに従い、以下の関数を実装します：
  > - `getUsersAction` - ユーザー一覧取得（クエリパラメータサポート）
  > - `getUserByIdAction` - 特定ユーザー取得
  > - `createUserAction` - ユーザー作成
  > - `updateUserAction` - ユーザー更新
  > - `deleteUserAction` - ユーザー削除
  >
  > **関連要件:** 要件1 (Server Actionの実装パターン統一), 要件3 (API呼び出しパターンの統一)

- [ ] **1.3. 特殊操作のserver action実装**
  > ユーザー特有の操作を実装します：
  > - `checkUserExistsAction` - ユーザー存在確認
  > - `getProfileOptionsAction` - プロフィールオプション取得
  >
  > **関連要件:** 要件1 (Server Actionの実装パターン統一), 要件3 (API呼び出しパターンの統一)

- [ ] **1.4. 検索機能のserver action実装**
  > 現在の`searchUsersAction`の機能を維持しながら、統一パターンで実装します：
  > - サーバーサイドフィルタリング機能を保持
  > - クエリパラメータ構築ロジックの統一
  > - 将来的なバックエンド検索対応の拡張性確保
  >
  > **関連要件:** 要件4 (クエリパラメータ処理の統一), 要件1 (Server Actionの実装パターン統一)

### 2. Import構造とエラーハンドリングの統一
> 統一されたimport構造とエラーハンドリングパターンを適用します。

- [ ] **2.1. Import文の統一と整理**
  > - `getHttpClient` を `../client/http-client` からimport
  > - `API_ENDPOINTS` を `../constants/config` からimport
  > - 型定義を `../types/` からimport（user、commonから必要な型）
  > - endpoints/users.tsへの参照を完全に削除
  >
  > **関連要件:** 要件2 (Import構造の統一)

- [ ] **2.2. エラーハンドリングの統一**
  > goals.tsと同じエラーハンドリングパターンを適用：
  > - try-catch構造の統一
  > - エラーメッセージ形式の統一
  > - レスポンス形式の統一（success/data/errorフィールド）
  >
  > **関連要件:** 要件3 (API呼び出しパターンの統一)

- [ ] **2.3. TypeScriptの型安全性確保**
  > すべての関数とレスポンスに適切な型注釈を適用：
  > - 引数の型定義
  > - 戻り値の型定義（Promise<StandardResponse>形式）
  > - HTTP clientの型パラメータ指定
  >
  > **関連要件:** 要件1 (Server Actionの実装パターン統一)

### 3. 不要ファイルの削除と依存関係整理
> endpoints/users.tsの削除と関連する依存関係の整理を行います。

- [ ] **3.1. endpoints/users.tsファイルの削除前チェック**
  > - 他のファイルからの参照がないことを確認
  > - server-actions/users.ts以外での使用状況を調査
  > - 削除による影響範囲の特定
  >
  > **関連要件:** 要件5 (コードの削減と重複排除)

- [ ] **3.2. endpoints/users.tsファイルの削除**
  > - 不要になった中間層ファイルを削除
  > - Git履歴の整理（必要に応じて）
  >
  > **関連要件:** 要件5 (コードの削減と重複排除)

- [ ] **3.3. Index.tsファイルの更新（もし存在する場合）**
  > endpoints/users.tsのexportを削除：
  > - endpoints/index.tsから該当するexport文を削除
  > - 他のindex.tsファイルで参照している場合は更新
  >
  > **関連要件:** 要件5 (コードの削減と重複排除)

## 機能B: 品質保証と整合性確認

### 4. テストと検証
> リファクタリング後の動作確認と品質保証を行います。

- [ ] **4.1. 各server actionの単体動作確認**
  > 新しく実装した各関数の動作テスト：
  > - 正常ケースでの動作確認
  > - エラーケースでの適切なエラーハンドリング確認
  > - レスポンス形式の確認
  >
  > **関連要件:** 要件6 (非機能要件 - パフォーマンス)

- [ ] **4.2. 統合テスト（実際のUIコンポーネントとの連携確認）**
  > - ユーザー管理画面での動作確認
  > - ユーザー検索機能の動作確認
  > - プロフィール作成機能の動作確認
  >
  > **関連要件:** 要件6 (非機能要件 - パフォーマンス)

- [ ] **4.3. パフォーマンステスト**
  > リファクタリング前後のパフォーマンス比較：
  > - レスポンス時間の測定
  > - バンドルサイズの比較
  > - メモリ使用量の確認
  >
  > **関連要件:** 要件6 (非機能要件 - パフォーマンス)

### 5. コード品質と標準化確認
> 実装されたコードがプロジェクトの標準に準拠していることを確認します。

- [ ] **5.1. goals.tsとの一貫性チェック**
  > - 同じパターンで実装されていることを確認
  > - コード構造、命名規則、エラーハンドリングの統一性確認
  > - import文の一貫性確認
  >
  > **関連要件:** 要件1 (Server Actionの実装パターン統一)

- [ ] **5.2. TypeScript型チェック**
  > - `npm run type-check` の実行
  > - すべての型エラーの解消
  > - 適切な型注釈の確認
  >
  > **関連要件:** 要件2 (Import構造の統一)

- [ ] **5.3. ESLint/Prettierによるコード品質チェック**
  > - `npm run lint` の実行
  > - コードフォーマットの統一
  > - 未使用importの削除確認
  >
  > **関連要件:** 要件5 (コードの削減と重複排除)

## 全般タスク

### 6. ドキュメント更新と知見共有

- [ ] **6.1. プロジェクトドキュメントの更新**
  > - CLAUDE.mdやREADMEでのAPIパターン説明の更新
  > - アーキテクチャ図の更新（必要に応じて）

- [ ] **6.2. 実装完了レポートの作成**
  > - 実施した変更の概要
  > - パフォーマンス改善の結果
  > - 今後の同様な作業への指針

### 7. 最終確認とクリーンアップ

- [ ] **7.1. Git履歴の整理**
  > - 適切なコミットメッセージの作成
  > - 必要に応じたスカッシュやリベース
  > - プルリクエストの準備

- [ ] **7.2. 依存関係の最終チェック**
  > - package.jsonの不要な依存関係確認
  > - バンドルサイズの最終確認
  > - セキュリティ脆弱性スキャン結果の確認